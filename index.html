<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0a0a0a">
    <meta name="description" content="Clear Ground - Energy Work Session Manager & Development Tracker">
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <title>Clear Ground</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Animated Background Canvas -->
    <canvas id="backgroundCanvas"></canvas>

    <!-- Loading Screen -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-icon">
            <img src="icons/icon.svg" alt="Clear Ground">
        </div>
        <div class="loading-app-name">Clear Ground</div>
        <div class="loading-text">Connecting to the source...</div>
        <div class="loading-dots">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </div>

    <!-- App Container -->
    <div class="app-container">
        <!-- Global Header -->
        <header class="global-header">
            <div class="global-header-left">
                <img src="icons/icon.svg" alt="" class="global-header-icon">
                <span class="global-header-title">Clear Ground</span>
            </div>
            <select id="currentUser" class="user-selector">
                <option value="">Loading...</option>
            </select>
        </header>

        <!-- Main Content Area -->
        <main class="content-area">
            <!-- Dashboard View (Default) -->
            <section id="viewDashboard" class="view active">
                <!-- Hero Section with Icon -->
                <div class="dashboard-hero">
                    <img src="icons/icon.svg" alt="" class="hero-icon">
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions">
                    <button class="action-btn" onclick="showView('track')">
                        <span class="btn-icon">◎</span>
                        <span class="btn-text">Track Progress</span>
                    </button>
                    <button class="action-btn" onclick="showView('timer')">
                        <span class="btn-icon">⏱</span>
                        <span class="btn-text">Do a Session</span>
                    </button>
                    <button class="action-btn" onclick="showView('playlists')">
                        <span class="btn-icon">▶</span>
                        <span class="btn-text">Programs</span>
                    </button>
                    <button class="action-btn" onclick="showView('stats')">
                        <span class="btn-icon">☰</span>
                        <span class="btn-text">Statistics</span>
                    </button>
                </div>

                <!-- Stats Summary (moved below actions) -->
                <div class="stats-summary">
                    <div class="stat-card">
                        <span class="stat-value" id="statTotalMarkers">-</span>
                        <span class="stat-label">Markers</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="statTodaySessions">-</span>
                        <span class="stat-label">Today</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="statTotalTime">-</span>
                        <span class="stat-label">Total</span>
                    </div>
                </div>
            </section>

            <!-- Track Progress View -->
            <section id="viewTrack" class="view">
                <div class="view-header">
                    <h2>Track Progress</h2>
                </div>

                <!-- Filter Row -->
                <div class="filter-row">
                    <select id="categoryFilter" class="filter-group">
                        <option value="">All Categories</option>
                        <option value="Foundations">⭐ Foundations</option>
                    </select>
                    <div class="toggle-container">
                        <label class="toggle-switch">
                            <input type="checkbox" id="blindModeToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                        <label>Blind</label>
                    </div>
                </div>

                <!-- Markers List -->
                <div id="markersList" class="markers-list">
                    <p class="loading">Loading markers...</p>
                </div>

                <!-- Assessment Modal -->
                <div id="assessmentModal" class="modal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 id="assessmentMarkerName">Marker Name</h3>
                            <button class="close-btn" onclick="closeAssessmentModal()">×</button>
                        </div>
                        <div class="modal-body">
                            <p id="assessmentDescription" class="marker-description"></p>
                            
                            <!-- Previous value shown when blind mode OFF -->
                            <div id="currentValueDisplay" class="current-value-display hidden">
                                <span class="current-value-label">Current value:</span>
                                <span id="currentValueAmount" class="current-value-amount">-</span>
                            </div>
                            
                            <div class="assessment-input">
                                <label>What do you sense now?</label>
                                <div class="slider-container">
                                    <input type="range" id="sensedValue" min="0" max="100" value="50">
                                    <div class="slider-value"><span id="sensedValueDisplay">50</span>%</div>
                                </div>
                            </div>

                            <div class="assessment-notes">
                                <label>Notes (optional)</label>
                                <textarea id="assessmentNotes" placeholder="Any observations..."></textarea>
                            </div>

                            <!-- Previous value reveal (shown after save in blind mode) -->
                            <div id="previousValueReveal" class="previous-reveal hidden">
                                <div class="reveal-content">
                                    <span class="reveal-label">Previous value was:</span>
                                    <span id="revealedPreviousValue" class="reveal-value">-</span>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button id="saveAssessmentBtn" class="btn primary" onclick="saveAssessment()">Save Assessment</button>
                            <button id="doneAssessmentBtn" class="btn secondary hidden" onclick="closeAssessmentModal()">Done</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Timer View -->
            <section id="viewTimer" class="view">
                <div class="view-header">
                    <h2>Energy Work</h2>
                </div>

                <!-- Timer Setup (shown when no timer running) -->
                <div id="timerSetup" class="timer-setup">
                    <div class="form-group">
                        <label>What are you working on?</label>
                        <select id="timerMarkerSelect">
                            <option value="">Select marker...</option>
                            <option value="custom">✦ Custom / General</option>
                        </select>
                    </div>

                    <div id="customWorkInput" class="form-group hidden">
                        <label>Custom work description</label>
                        <input type="text" id="customWorkName" placeholder="e.g., General clearing">
                    </div>

                    <div class="form-group">
                        <label>Duration</label>
                        <div class="duration-presets">
                            <button class="preset-btn" onclick="setDuration(15)">15m</button>
                            <button class="preset-btn" onclick="setDuration(30)">30m</button>
                            <button class="preset-btn" onclick="setDuration(60)">1h</button>
                            <button class="preset-btn" onclick="setDuration(90)">1.5h</button>
                            <button class="preset-btn" onclick="setDuration(120)">2h</button>
                        </div>
                        <div class="custom-duration">
                            <input type="number" id="customDuration" min="1" max="1440" placeholder="Custom minutes">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Energy Type / Transmission</label>
                        <select id="energyType">
                            <option value="">Select type...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Intensity</label>
                        <div class="intensity-select">
                            <button class="intensity-btn" data-intensity="low">Low</button>
                            <button class="intensity-btn active" data-intensity="medium">Medium</button>
                            <button class="intensity-btn" data-intensity="high">High</button>
                            <button class="intensity-btn" data-intensity="highest">Highest</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Session Notes</label>
                        <textarea id="timerNotes" placeholder="Intentions, focus areas..."></textarea>
                    </div>

                    <button class="btn primary large" onclick="startTimer()">
                        <span class="btn-icon">▶</span>
                        Start Session
                    </button>
                </div>

                <!-- Active Timer (shown when timer running) -->
                <div id="timerActive" class="timer-active hidden">
                    <div class="timer-display">
                        <div class="timer-icon-pulse">
                            <img src="icons/icon.svg" alt="" class="timer-icon">
                        </div>
                        <div class="timer-target" id="timerTargetName">Target Name</div>
                        <div class="timer-countdown" id="timerCountdown">00:00:00</div>
                        <div class="timer-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" id="timerProgressBar"></div>
                            </div>
                        </div>
                        <span class="timer-percentage" id="timerPercentage">0%</span>
                    </div>

                    <div class="timer-info">
                        <div class="info-row">
                            <span class="info-label">Energy:</span>
                            <span id="timerEnergyType">-</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Intensity:</span>
                            <span id="timerIntensity">-</span>
                        </div>
                    </div>

                    <div class="timer-notes-display" id="timerNotesDisplay"></div>

                    <div class="timer-controls">
                        <button class="btn secondary" onclick="pauseTimer()" id="pauseBtn">
                            <span class="btn-icon">⏸</span> Pause
                        </button>
                        <button class="btn danger" onclick="endTimer()">
                            <span class="btn-icon">⏹</span> End Session
                        </button>
                    </div>
                </div>
            </section>

            <!-- Playlists View -->
            <section id="viewPlaylists" class="view">
                <div class="view-header">
                    <h2>Programs</h2>
                    <button class="btn small" onclick="showCreatePlaylist()">+ New</button>
                </div>

                <div id="playlistsList" class="playlists-list">
                    <p class="empty-state">No programs yet</p>
                </div>

                <!-- Create/Edit Playlist Modal -->
                <div id="playlistModal" class="modal">
                    <div class="modal-content large">
                        <div class="modal-header">
                            <h3 id="playlistModalTitle">Create Program</h3>
                            <button class="close-btn" onclick="closePlaylistModal()">×</button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label>Program Name</label>
                                <input type="text" id="playlistName" placeholder="e.g., Morning Routine">
                            </div>

                            <div class="playlist-items">
                                <h4>Items <button class="btn tiny" onclick="addPlaylistItem()">+ Add</button></h4>
                                <div id="playlistItemsList" class="playlist-items-sortable"></div>
                            </div>

                            <div class="playlist-total">
                                Total Duration: <span id="playlistTotalDuration">0 min</span>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button class="btn secondary" onclick="closePlaylistModal()">Cancel</button>
                            <button class="btn primary" onclick="savePlaylist()">Save Program</button>
                        </div>
                    </div>
                </div>

                <!-- Running Program -->
                <div id="playlistRunner" class="playlist-runner hidden">
                    <div class="runner-header">
                        <h3 id="runningPlaylistName">Program Name</h3>
                        <div class="runner-progress">
                            <span id="runnerCurrentItem">1</span> / <span id="runnerTotalItems">5</span>
                        </div>
                    </div>
                    <div class="runner-current">
                        <div class="current-item-name" id="runnerItemName">Current Item</div>
                        <div class="current-item-timer" id="runnerItemTimer">00:00:00</div>
                        <div class="current-item-info" id="runnerItemInfo"></div>
                    </div>
                    <div class="runner-queue" id="runnerQueue"></div>
                    <div class="runner-controls">
                        <button class="btn secondary" onclick="pausePlaylist()" id="playlistPauseBtn">
                            <span class="btn-icon">⏸</span> Pause
                        </button>
                        <button class="btn secondary" onclick="skipPlaylistItem()">Skip →</button>
                        <button class="btn danger" onclick="stopPlaylist()">Stop</button>
                    </div>
                </div>
            </section>

            <!-- Statistics View -->
            <section id="viewStats" class="view">
                <div class="view-header">
                    <h2>Statistics</h2>
                </div>

                <!-- Time Period Filter -->
                <div class="stats-filter">
                    <select id="statsPeriod" onchange="updateStats()">
                        <option value="7">Last 7 days</option>
                        <option value="30" selected>Last 30 days</option>
                        <option value="90">Last 90 days</option>
                        <option value="365">Last year</option>
                        <option value="all">All time</option>
                    </select>
                </div>

                <!-- Summary Cards -->
                <div class="stats-summary">
                    <div class="stat-card">
                        <span class="stat-value" id="statsSessions">-</span>
                        <span class="stat-label">Sessions</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="statsTotalHours">-</span>
                        <span class="stat-label">Total Hours</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="statsAvgSession">-</span>
                        <span class="stat-label">Avg Session</span>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="stats-charts">
                    <div class="chart-card">
                        <h3>Session Time by Day</h3>
                        <div class="chart-container">
                            <canvas id="dailyChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card">
                        <h3>Time by Marker</h3>
                        <div id="markerBreakdown" class="breakdown-list"></div>
                    </div>

                    <div class="chart-card">
                        <h3>Recent Activity</h3>
                        <div id="recentActivityList" class="activity-list"></div>
                    </div>

                    <div class="chart-card">
                        <h3>Progress Trends</h3>
                        <div class="form-group">
                            <select id="progressTrendMarker" onchange="updateProgressTrend()">
                                <option value="">Select marker...</option>
                            </select>
                        </div>
                        <div class="chart-container">
                            <canvas id="progressChart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card">
                        <h3>Session Correlation</h3>
                        <p class="chart-description">Time spent vs. progress improvement</p>
                        <div id="correlationView" class="correlation-list"></div>
                    </div>
                </div>
            </section>

            <!-- History View -->
            <section id="viewHistory" class="view">
                <div class="view-header">
                    <h2>History</h2>
                    <div class="history-tabs">
                        <button class="tab-btn active" onclick="showHistoryTab('sessions')">Sessions</button>
                        <button class="tab-btn" onclick="showHistoryTab('progress')">Progress</button>
                    </div>
                </div>

                <div id="historySessionsTab" class="history-tab active">
                    <div id="sessionsHistoryList" class="history-list">
                        <p class="loading">Loading sessions...</p>
                    </div>
                </div>

                <div id="historyProgressTab" class="history-tab">
                    <div class="filter-group">
                        <select id="progressMarkerFilter">
                            <option value="">All Markers</option>
                        </select>
                    </div>
                    <div id="progressHistoryList" class="history-list">
                        <p class="loading">Loading progress...</p>
                    </div>
                </div>
            </section>

            <!-- Settings View -->
            <section id="viewSettings" class="view">
                <div class="view-header">
                    <h2>Settings</h2>
                </div>

                <div class="settings-section">
                    <h3>Notifications</h3>
                    <div class="settings-row">
                        <div class="settings-label">
                            <span>Sound on completion</span>
                            <span class="settings-hint">Play chime when timer ends</span>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="settingSoundEnabled" onchange="saveSetting('soundEnabled', this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="settings-row">
                        <div class="settings-label">
                            <span>Vibration on completion</span>
                            <span class="settings-hint">Vibrate when timer ends</span>
                        </div>
                        <label class="toggle">
                            <input type="checkbox" id="settingVibrationEnabled" onchange="saveSetting('vibrationEnabled', this.checked)">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>Energy Transmissions</h3>
                    <p class="settings-hint" style="margin-bottom: var(--space-md);">Custom energy types for timer & playlists</p>
                    <div id="transmissionsList" class="transmissions-list"></div>
                    <div class="add-transmission-row">
                        <input type="text" id="newTransmissionName" placeholder="New transmission name...">
                        <button class="btn small" onclick="addTransmission()">Add</button>
                    </div>
                </div>

                <div class="settings-section">
                    <h3>Users</h3>
                    <div id="usersList" class="users-list"></div>
                    <button class="btn secondary" onclick="showAddUserModal()">+ Add User</button>
                </div>

                <div class="settings-section">
                    <h3>Markers</h3>
                    <button class="btn secondary" onclick="showAddMarkerModal()">+ Add Custom Marker</button>
                </div>

                <div class="settings-section">
                    <h3>Data</h3>
                    <button class="btn secondary" onclick="exportData()">Export Data</button>
                    <button class="btn secondary" onclick="syncData()">Sync Now</button>
                </div>

                <div class="settings-section">
                    <h3>About</h3>
                    <p class="version">Clear Ground v3.0</p>
                    <p class="copyright">Professional Energy Work Management</p>
                </div>
            </section>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-btn active" onclick="showView('dashboard')" data-view="dashboard">
                <span class="nav-icon">⌂</span>
                <span class="nav-label">Home</span>
            </button>
            <button class="nav-btn" onclick="showView('track')" data-view="track">
                <span class="nav-icon">◎</span>
                <span class="nav-label">Track</span>
            </button>
            <button class="nav-btn" onclick="showView('timer')" data-view="timer">
                <span class="nav-icon">⏱</span>
                <span class="nav-label">Energy</span>
            </button>
            <button class="nav-btn" onclick="showView('stats')" data-view="stats">
                <span class="nav-icon">▤</span>
                <span class="nav-label">Stats</span>
            </button>
            <button class="nav-btn" onclick="showView('settings')" data-view="settings">
                <span class="nav-icon">⚙</span>
                <span class="nav-label">Settings</span>
            </button>
        </nav>

        <!-- Add User Modal -->
        <div id="addUserModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Add User</h3>
                    <button class="close-btn" onclick="closeAddUserModal()">×</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" id="newUserName" placeholder="Enter name">
                    </div>
                    <div class="form-group">
                        <label>Notes (optional)</label>
                        <textarea id="newUserNotes" placeholder="Any notes about this user"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn secondary" onclick="closeAddUserModal()">Cancel</button>
                    <button class="btn primary" onclick="addUser()">Add User</button>
                </div>
            </div>
        </div>

        <!-- Add Marker Modal -->
        <div id="addMarkerModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Add Custom Marker</h3>
                    <button class="close-btn" onclick="closeAddMarkerModal()">×</button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label>Category</label>
                        <select id="newMarkerCategory">
                            <option value="Custom">Custom</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" id="newMarkerName" placeholder="Enter marker name">
                    </div>
                    <div class="form-group">
                        <label>Description (optional)</label>
                        <textarea id="newMarkerDescription" placeholder="What does this marker track?"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn secondary" onclick="closeAddMarkerModal()">Cancel</button>
                    <button class="btn primary" onclick="addMarker()">Add Marker</button>
                </div>
            </div>
        </div>

        <!-- Toast Container -->
        <div class="toast-container" id="toastContainer"></div>
    </div>

    <script src="app.js"></script>
</body>
</html>
